'use strict';let getType=(a)=>Object.prototype.toString.call(a),isObject=(a)=>null!==a&&'[object Object]'===getType(a),isArray=(a)=>'[object Array]'===getType(a),isFunction=(a)=>'[object Function]'===getType(a),setImmediate=(a)=>a(),deepCopy=(a)=>{if(isArray(a))return[].slice.call(a);if(!isObject(a))return a;let b={};return Object.keys(a).forEach((d)=>b[d]=deepCopy(a[d])),b},deepEqual=(a,b)=>{if(null===a&&null!==b||null===a&&null!==b)return!1;if(null===a&&null===b)return!0;if(!isObject(a)&&isObject(b)||isObject(a)&&!isObject(b))return!1;if(!isObject(a)&&!isObject(b)&&!isArray(a)&&!isArray(b))return a==b;let d=Object.keys(a);for(let f of d){if(!b.hasOwnProperty(f))return!1;if(!deepEqual(a[f],b[f]))return!1}let e=Object.keys(b);for(let f of e){if(!a.hasOwnProperty(f))return!1;if(!deepEqual(a[f],b[f]))return!1}return!0};class VirtualDOMNode{constructor(a){this.tagName=a,this.attributes={},this.children=[],this.eventListeners={}}appendChild(a){a.parent=this,this.children.push(a)}setAttribute(a,b){!b||(this.attributes[a]=b)}getAttribute(a){return this.attributes[a]}removeChild(a){let b=this.children.indexOf(a);if(0>b)throw'Children not found';this.children=this.children.slice(0,b).concat(b+1,this.children.length)}addEventListener(a,b){this.eventListeners[a]||(this.eventListeners[a]=[]),this.eventListeners[a].push(b)}dispatchEvent(a){a.type&&this.eventListeners[a.type]&&this.eventListeners[a.type].forEach((b)=>b.call(this,a))}removeEventListener(a,b){let d=this.eventListeners[a];if(d){let e=d.indexOf(b);this.eventListeners[a]=d.slice(0,e).concat(d.slice(e,d.length))}}get value(){return this.elt?this.elt.value:void 0}equal(a){return this.elt&&a.elt&&this.elt==a.elt&&this.innerText==a.innerText&&deepEqual(this.attributes,a.attributes)&&this.children.every((b,d)=>b.equal(a.children[d]))}applyChanges(a){this.elt||this.mount();let[b,d,e]=[a.children,a.attributes,a.innerText];for(let g,f=0;f<b.length;f++){if(g=b[f],f>=this.children.length)this.children.push(g),g.parent=this;else if(this.children[f].equal(g))continue;this.children[f].applyChanges(g)}for(let f=b.length;f<this.children.length;f++)this.children[f].elt&&this.children[f].elt.parentNode==this.elt&&this.elt.removeChild(this.children[f].elt);this.children=this.children.slice(0,b.length),d&&!deepEqual(this.attributes,d)&&(Object.keys(d).forEach((f)=>{let g=d[f];this.attributes[f]==g||(this.attributes[f]=g,this.elt.setAttribute(f,g))}),Object.keys(this.attributes).forEach((f)=>{'undefined'==typeof d[f]&&(delete this.attributes[f],this.elt.removeAttribute(f))})),e&&e!=this.innerText&&(this.innerText=e,'input'==this.tagName?this.elt.value=e:this.elt.innerText=e)}mount(a){this.elt=document.createElement(this.tagName),'undefined'!=typeof this.innerText&&null!==this.innerText&&(this.elt.innerText=this.innerText),Object.keys(this.attributes).forEach((b)=>this.elt.setAttribute(b,this.attributes[b])),Object.keys(this.eventListeners).forEach((b)=>{this.eventListeners[b].forEach((d)=>this.elt.addEventListener(b,d.bind(this.elt)))}),setImmediate(()=>{this.children.filter((d)=>!d.elt).forEach((d)=>d.mount(this.elt))}),this.parent&&this.parent.elt?this.parent.elt.appendChild(this.elt):a&&a.appendChild(this.elt)}}class Store{constructor(a){this.state=deepCopy(a),this.listeners=[],this.reducers=[]}static createStore(a){return new Store(a)}getState(){return deepCopy(this.state)}onAction(a){this.reducers.push(a)}onStateChanged(a){this.listeners.push(a)}dispatch(a){setImmediate(()=>{let d=deepCopy(this.state),e=this.reducers.reduce((f,g)=>g.call(null,f,a),this.state);deepEqual(e,d)||(this.state=e,this.listeners.forEach((f)=>f.call(null,e,d)))})}}class ComponentInstance{constructor(a,b){this.viewFn=a,this.updateFn=b}render(){let a=this.viewFn.call(null,this.store.getState(),this.children,this.store.dispatch.bind(this.store));return this.view?this.view.applyChanges(a):this.view=a,this.view}init(a,b){return this.store=a,this.children=b,this.store.onAction(this.updateFn.bind(this)),this.store.onStateChanged(this.render.bind(this)),this}mount(a){return this.render().mount(a),this}equal(a){return this.view&&a.view&&this.view.equal(a.view)}applyChanges(a){if(VirtualDOMNode.prototype.isPrototypeOf(a))return this.view.applyChanges(a);return ComponentInstance.prototype.isPrototypeOf(a)?a.view?this.view.applyChanges(a.view):this.view.applyChanges(a.render()):void 0}}class ComponentFactory{constructor(a,b,d){this.viewFn=a,this.updateFn=b,this.storeFactory=d}init(a,b){let d=new ComponentInstance(this.viewFn,this.updateFn),e=this.storeFactory.call(null,a);return d.init(e,b)}}let createComponent=(a,b)=>new ComponentFactory(a,b||((d)=>d),(d)=>new Store(d)),connectComponentToStore=function(a,b){return a.storeFactory=(d)=>{return b.state=Object.assign({},b.getState(),d),b},a},c=function(a,b,d){let e,h,f=[],g={};return(isArray(b)?f=b.slice():isObject(b)?(g=b,isArray(d)?f=d.slice():h=d):h=b,ComponentFactory.prototype.isPrototypeOf(a))?a.init(g,f||h):(e=new VirtualDOMNode(a),Object.keys(g).forEach((i)=>{let j=g[i];isFunction(j)?e.addEventListener(i,j):e.setAttribute(i,j)}),f.forEach((i)=>{'undefined'==typeof i||null==i||(VirtualDOMNode.prototype.isPrototypeOf(i)?e.appendChild(i):ComponentInstance.prototype.isPrototypeOf(i)&&e.appendChild(i.render()))}),e.innerText=h,e)};'undefined'==typeof window?'object'==typeof module&&null!=module&&module.exports&&(module.exports={createComponent,createStore:Store.createStore,c}):(window.createComponent=createComponent,window.createStore=Store.createStore,window.connectComponentToStore=connectComponentToStore,window.c=c);
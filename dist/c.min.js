(function(){'use strict';let a=(t)=>Object.prototype.toString.call(t),b=(t)=>null!==t&&'[object Object]'===a(t),d=(t)=>'[object Array]'===a(t),g=(t)=>'[object Function]'===a(t),h=(t)=>n.prototype.isPrototypeOf(t),i=(t)=>{if(d(t))return[].slice.call(t);if(!b(t))return t;let u={};return Object.keys(t).forEach((v)=>u[v]=i(t[v])),u},j=(t)=>t.reduce((u,v)=>u.concat(d(v)?j(v):[v]),[]),l=(t,u)=>{if(null===t&&null!==u||null===t&&null!==u)return!1;if(null===t&&null===u)return!0;if(!b(t)&&b(u)||b(t)&&!b(u))return!1;if(!b(t)&&!b(u)&&!d(t)&&!d(u))return t==u;let v=Object.keys(t);for(let x of v){if(!u.hasOwnProperty(x))return!1;if(!l(t[x],u[x]))return!1}let w=Object.keys(u);for(let x of w){if(!t.hasOwnProperty(x))return!1;if(!l(t[x],u[x]))return!1}return!0};Object.deepEqual=l,Object.deepCopy=i;let m=(t)=>setTimeout(t,0);class n{constructor(t,u,v,w){this.tagName=t,this.attributes=u||{},this.children=v||[],this.innerText=w||null,this.parent=null,this.elt=null,this.eventListeners={}}appendChild(t){t.parent=this,this.children.push(t)}setAttribute(t,u){this.attributes[t]=u}getAttribute(t){return this.attributes[t]}removeChild(t){let u=this.children.indexOf(t);if(0>u)throw'Children not found';this.children=this.children.slice(0,u).concat(u+1,this.children.length)}addEventListener(t,u){this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(u)}dispatchEvent(t){t.type&&this.eventListeners[t.type]&&this.eventListeners[t.type].forEach((u)=>u.call(this,t))}removeEventListener(t,u){let v=this.eventListeners[t];if(v){let w=v.indexOf(u);this.eventListeners[t]=v.slice(0,w).concat(v.slice(w,v.length))}}equal(t){return this.elt&&t.elt&&this.elt==t.elt&&this.text==t.text&&Object.deepEqual(this.attributes,t.attributes)&&this.children.every((u,v)=>u.equal(t.children[v]))}applyChanges(t){this.elt||this.materialize();let[u,v,w]=[t.children,t.attributes,t.innerText];u.forEach((x,y)=>{if(y>=this.children.length)this.children.push(x);else if(this.children[y].equal(x))return;this.children[y].applyChanges(x)}),v&&!Object.deepEqual(this.attributes,v)&&(Object.keys(v).forEach((x)=>{let y=v[x];this.attributes[x]==y||(this.attributes[x]=y,this.elt.setAttribute(x,y))}),Object.keys(this.attributes).forEach((x)=>{'undefined'==typeof v[x]&&(delete this.attributes[x],this.elt.removeAttribute(x))})),w&&w!=this.innerText&&(this.innerText=w,this.elt.innerText=w)}materialize(t){this.elt=document.createElement(this.tagName),'undefined'!=typeof this.innerText&&null!==this.innerText&&(this.elt.innerText=this.innerText),Object.keys(this.attributes).forEach((u)=>this.elt.setAttribute(u,this.attributes[u])),Object.keys(this.eventListeners).forEach((u)=>{this.eventListeners[u].forEach((v)=>this.elt.addEventListener(u,v.bind(this.elt)))}),m(()=>{this.children.forEach((v)=>v.materialize(this.elt))}),this.parent&&this.parent.elt?this.parent.elt.appendChild(this.elt):t&&t.appendChild(this.elt)}}class o{constructor(t,u,v){let w,x,y;d(u)?w=u.slice():b(u)?(x=u,w=d(v)?v.slice():[v]):w=[u],w=w?j(w):[],x=x||{},y=new n(t),Object.keys(x).forEach((z)=>{let A=x[z];g(A)?y.addEventListener(z,A):y.setAttribute(z,A)}),w.forEach((z)=>{'undefined'==typeof z||null==z||(h(z)?y.appendChild(z):z instanceof o?y.appendChild(z.elt):y.innerText=z)}),this.elt=y}mount(t){this.elt.materialize(t)}unmount(){this.elt.parentElement.removeChild(this.elt)}on(t,u,v){this.elt.addEventListener(t,u.bind(this),v)}fire(t){var u=new Event(t,[].slice.apply(arguments,1));this.elt.dispatchEvent(u)}}let p=(t,u,v)=>new o(t,u,v);class q{constructor(t){this.state=Object.deepCopy(t),this.listener=()=>null,this.reducer=(u)=>u}static createStore(t){return new q(t)}getState(){return Object.deepCopy(this.state)}onAction(t){this.reducer=t}onStateChanged(t){this.listener=t}dispatch(t){m(()=>{let v=Object.deepCopy(this.state),w=this.reducer(this.state,t);Object.deepEqual(w,v)||(this.state=w,this.listener(w,v))})}}class r{constructor(t,u,v){this.store=new q(t),this.updateFn=u,this.viewFn=v,this.view=null,this.store.onAction(this._onAction.bind(this)),this.store.onStateChanged(this._onStateChanged.bind(this))}mount(t){this.view=this.viewFn.call(null,this.store.getState(),this.dispatch.bind(this)),this.view.elt.materialize(t)}dispatch(t){this.store.dispatch(t)}_onAction(t,u){return this.updateFn.call(null,t,u)}_onStateChanged(t){let u=this.viewFn.call(null,t,this.dispatch.bind(this));this.view.elt.applyChanges(u.elt)}}let s=(t,u,v)=>new r(t,u,v);if('undefined'!=typeof window)window.c=p,window.createApplication=s;else if('object'==typeof module&&null!=module&&module.exports)module.exports={c:p,createApplication:s};else return p})();
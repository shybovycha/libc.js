'use strict';let getType=(a)=>Object.prototype.toString.call(a),isObject=(a)=>null!==a&&'[object Object]'===getType(a),isArray=(a)=>'[object Array]'===getType(a),isFunction=(a)=>'[object Function]'===getType(a),setImmediate=(a)=>setTimeout(a,0),deepCopy=(a)=>{if(isArray(a))return[].slice.call(a);if(!isObject(a))return a;let b={};return Object.keys(a).forEach((d)=>b[d]=deepCopy(a[d])),b},deepEqual=(a,b)=>{if(null===a&&null!==b||null===a&&null!==b)return!1;if(null===a&&null===b)return!0;if(!isObject(a)&&isObject(b)||isObject(a)&&!isObject(b))return!1;if(!isObject(a)&&!isObject(b)&&!isArray(a)&&!isArray(b))return a==b;let d=Object.keys(a);for(let f of d){if(!b.hasOwnProperty(f))return!1;if(!deepEqual(a[f],b[f]))return!1}let e=Object.keys(b);for(let f of e){if(!a.hasOwnProperty(f))return!1;if(!deepEqual(a[f],b[f]))return!1}return!0},isDOM=(a)=>VirtualDOMNode.prototype.isPrototypeOf(a);class VirtualDOMNode{constructor(a,b,d,e){this.tagName=a,this.attributes=b||{},this.children=d||[],this.innerText=e||null,this.parent=null,this.elt=null,this.eventListeners={}}appendChild(a){a.parent=this,this.children.push(a)}setAttribute(a,b){this.attributes[a]=b}getAttribute(a){return this.attributes[a]}removeChild(a){let b=this.children.indexOf(a);if(0>b)throw'Children not found';this.children=this.children.slice(0,b).concat(b+1,this.children.length)}addEventListener(a,b){this.eventListeners[a]||(this.eventListeners[a]=[]),this.eventListeners[a].push(b)}dispatchEvent(a){a.type&&this.eventListeners[a.type]&&this.eventListeners[a.type].forEach((b)=>b.call(this,a))}removeEventListener(a,b){let d=this.eventListeners[a];if(d){let e=d.indexOf(b);this.eventListeners[a]=d.slice(0,e).concat(d.slice(e,d.length))}}equal(a){return this.elt&&a.elt&&this.elt==a.elt&&this.text==a.text&&deepEqual(this.attributes,a.attributes)&&this.children.every((b,d)=>b.equal(a.children[d]))}applyChanges(a){this.elt||this.materialize();let[b,d,e]=[a.children,a.attributes,a.innerText];b.forEach((f,g)=>{if(g>=this.children.length)this.children.push(f);else if(this.children[g].equal(f))return;this.children[g].applyChanges(f)}),d&&!deepEqual(this.attributes,d)&&(Object.keys(d).forEach((f)=>{let g=d[f];this.attributes[f]==g||(this.attributes[f]=g,this.elt.setAttribute(f,g))}),Object.keys(this.attributes).forEach((f)=>{'undefined'==typeof d[f]&&(delete this.attributes[f],this.elt.removeAttribute(f))})),e&&e!=this.innerText&&(this.innerText=e,this.elt.innerText=e)}materialize(a){this.elt=document.createElement(this.tagName),'undefined'!=typeof this.innerText&&null!==this.innerText&&(this.elt.innerText=this.innerText),Object.keys(this.attributes).forEach((b)=>this.elt.setAttribute(b,this.attributes[b])),Object.keys(this.eventListeners).forEach((b)=>{this.eventListeners[b].forEach((d)=>this.elt.addEventListener(b,d.bind(this.elt)))}),setImmediate(()=>{this.children.forEach((d)=>d.materialize(this.elt))}),this.parent&&this.parent.elt?this.parent.elt.appendChild(this.elt):a&&a.appendChild(this.elt)}}let c=function(a,b,d){let e,f,g;return isArray(b)?e=b.slice():isObject(b)?(f=b,e=isArray(d)?d.slice():[d]):e=[b],e=e||[],f=f||{},g=new VirtualDOMNode(a),Object.keys(f).forEach((h)=>{let i=f[h];isFunction(i)?g.addEventListener(h,i):g.setAttribute(h,i)}),e.forEach((h)=>{'undefined'==typeof h||null==h||(isDOM(h)?g.appendChild(h):g.innerText=h)}),g};class Store{constructor(a){this.state=deepCopy(a),this.listener=()=>null,this.reducer=(b)=>b}static createStore(a){return new Store(a)}getState(){return deepCopy(this.state)}onAction(a){this.reducer=a}onStateChanged(a){this.listener=a}dispatch(a){setImmediate(()=>{let d=deepCopy(this.state),e=this.reducer(this.state,a);deepEqual(e,d)||(this.state=e,this.listener(e,d))})}}class Application{constructor(a,b,d){this.store=new Store(a),this.updateFn=b,this.viewFn=d,this.view=null,this.store.onAction(this._onAction.bind(this)),this.store.onStateChanged(this._onStateChanged.bind(this))}mount(a){this.view=this.viewFn.call(null,this.store.getState(),this.dispatch.bind(this)),this.view.materialize(a)}dispatch(a){this.store.dispatch(a)}_onAction(a,b){return this.updateFn.call(null,a,b)}_onStateChanged(a){let b=this.viewFn.call(null,a,this.dispatch.bind(this));this.view.applyChanges(b)}}let createApplication=(a,b,d)=>new Application(a,b,d);'undefined'==typeof window?'object'==typeof module&&null!=module&&module.exports&&(module.exports={c,createApplication}):(window.c=c,window.createApplication=createApplication);